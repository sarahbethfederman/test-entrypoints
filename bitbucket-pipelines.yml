image: node:latest

pipelines:
  default:

    - step:
        name: ⬇️ Install
        script:
          - mv .npmrc_config .npmrc
          - yarn 
        caches:
          - nodemonorepo

    - parallel:

      - step:
          name: ✅ Lint
          script:
            - mv .npmrc_config .npmrc
            - yarn
            - yarn run lint
            - "\"$(yarn bin)/prettier-check\" \"*.{json,js,jsx,ts,tsx,md}\" \"packages/*/*/src/**/*.{json,js,jsx,ts,tsx,md}\""
          caches:
            - nodemonorepo

      - step:
          name: ⚒ Build
          script:
            - mv .npmrc_config .npmrc
            - yarn
            - yarn run build
          caches:
            - nodemonorepo 
          artifacts:
            - "**/dist/**"

      - step:
          name: 📝 Test
          script:
            - mv .npmrc_config .npmrc
            - yarn
            - yarn run build
            - yarn run test
          caches:
            - nodemonorepo

    - step:
        name: 🚀 Deploy
        script:
          - mv .npmrc_config .npmrc
          - yarn
          - yarn run deploy
        caches:
          - nodemonorepo

definitions:
  caches:
    nodemonorepo: "**/node_modules/**"