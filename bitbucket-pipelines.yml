image: node:latest

pipelines:
  default:

    - parallel:

      - step:
          name: âœ… Lint
          script:
            - ./ci/lint.sh 
          caches:
            - nodemonorepo

      - step:
          name: âš’ Build
          script:
            - ./ci/build.sh
          caches:
            - nodemonorepo 
          artifacts:
            - "**/dist/**"

      - step:
          name: ğŸ“ Test
          script:
            - ./ci/test.sh
          caches:
            - nodemonorepo

    - parallel:
          
      - step:
          name: ğŸš€ Deploy
          script:
            - ./ci/deploy.sh
          caches:
            - nodemonorepo

  master:

    - parallel:

      - step:
          name: âœ… Lint
          script:
            - ./ci/lint.sh 
          caches:
            - nodemonorepo

      - step:
          name: âš’ Build
          script:
            - ./ci/build.sh
          caches:
            - nodemonorepo 
          artifacts:
            - "**/dist/**"

      - step:
          name: ğŸ“ Test
          script:
            - ./ci/test.sh
          caches:
            - nodemonorepo

    - parallel:
          
      - step:
          name: ğŸš€ Deploy
          script:
            - ./ci/deploy.sh
          caches:
            - nodemonorepo
        
      - step:
          name: ğŸ“¦ Publish 
          script:
            - ./ci/publish.sh
          caches:
            - nodemonorepo

definitions:
  caches:
    nodemonorepo: "**/node_modules/**"